name: CI

on: [push, pull_request]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true


jobs:
  gcc:
    name: gcc-clang-build-and-tests
    strategy:
      matrix:
        include:
          - os: ubuntu-22.04
            compiler: gcc
          - os: ubuntu-22.04
            compiler: clang
          - os: macos-12
            compiler: gcc
          - os: macos-12
            compiler: clang

    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/test-unix
        with:
          compiler: ${{ matrix.compiler }}

  windows:
    name: windows-cmake-build-tests
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/compile-windows

  nvim-tests:
    name: nvim-tests
    strategy:
      matrix:
        os:
          - ubuntu-22.04
          - macos-12

        include:
          - os: ubuntu-20.04
            url: https://github.com/neovim/neovim/releases/download/nightly/nvim-linux64.tar.gz
          - os: macos-10.15
            url: https://github.com/neovim/neovim/releases/download/nightly/nvim-macos.tar.gz

    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/nvim-unix-test
        with:
          os: ${{ matrix.os }}
          url: ${{ matrix.url }}

